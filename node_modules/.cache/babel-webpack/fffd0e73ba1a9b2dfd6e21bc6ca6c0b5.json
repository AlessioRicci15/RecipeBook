{"ast":null,"code":"\"use strict\";\n\nvar _asyncToGenerator = require(\"/Users/alessioricci/projects/udemy/udemy-app/node_modules/@babel/runtime/helpers/asyncToGenerator\").default;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.callBeforeAppShutdownHook = void 0;\n\nconst shared_utils_1 = require(\"@nestjs/common/utils/shared.utils\");\n\nconst iterare_1 = require(\"iterare\");\n\nconst transient_instances_1 = require(\"../injector/helpers/transient-instances\");\n/**\n * Checks if the given instance has the `beforeApplicationShutdown` function\n *\n * @param instance The instance which should be checked\n */\n\n\nfunction hasBeforeApplicationShutdownHook(instance) {\n  return !shared_utils_1.isNil(instance.beforeApplicationShutdown);\n}\n/**\n * Calls the given instances\n */\n\n\nfunction callOperator(instances, signal) {\n  return iterare_1.iterate(instances).filter(instance => !shared_utils_1.isNil(instance)).filter(hasBeforeApplicationShutdownHook).map( /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator(function* (instance) {\n      return instance.beforeApplicationShutdown(signal);\n    });\n\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }()).toArray();\n}\n/**\n * Calls the `beforeApplicationShutdown` function on the module and its children\n * (providers / controllers).\n *\n * @param module The module which will be initialized\n * @param signal The signal which caused the shutdown\n */\n\n\nfunction callBeforeAppShutdownHook(_x2, _x3) {\n  return _callBeforeAppShutdownHook.apply(this, arguments);\n}\n\nfunction _callBeforeAppShutdownHook() {\n  _callBeforeAppShutdownHook = _asyncToGenerator(function* (module, signal) {\n    const providers = module.getNonAliasProviders();\n    const [_, moduleClassHost] = providers.shift();\n    const instances = [...module.controllers, ...providers];\n    const nonTransientInstances = transient_instances_1.getNonTransientInstances(instances);\n    yield Promise.all(callOperator(nonTransientInstances, signal));\n    const transientInstances = transient_instances_1.getTransientInstances(instances);\n    yield Promise.all(callOperator(transientInstances, signal));\n    const moduleClassInstance = moduleClassHost.instance;\n\n    if (moduleClassInstance && hasBeforeApplicationShutdownHook(moduleClassInstance) && moduleClassHost.isDependencyTreeStatic()) {\n      yield moduleClassInstance.beforeApplicationShutdown(signal);\n    }\n  });\n  return _callBeforeAppShutdownHook.apply(this, arguments);\n}\n\nexports.callBeforeAppShutdownHook = callBeforeAppShutdownHook;","map":null,"metadata":{},"sourceType":"script"}